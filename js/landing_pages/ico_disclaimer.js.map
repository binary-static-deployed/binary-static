{"version":3,"sources":["../../../src/javascript/landing_pages/ico_disclaimer.js"],"names":["el_residence_list","window","onload","frm_select_residence","document","getElementById","frm_accept_disclaimer","frm_accept_second_notice","getWebsocketData","msg_type","req","residence_list","ico_status","JSON","parse","sessionStorage","getItem","populateResidenceList","isRestrictedCountry","val","restricted_countries","ico_countries_config","restricted","indexOf","country_names","code","name","showSecondNotice","country_name","map","item","idx","appendChild","createTextNode","classList","remove","el","showDisclaimer","test","hideForm","parentNode","add","addEventListener","e","preventDefault","checked","url","location","href","validation_set","value","validateResidence","evt","el_error","getElementsByClassName","requests","done","filter","r","length","setTimeout","sendRequests","forEach","wsSend","ws","wsConnect","readyState","onopen","onmessage","msg","response","data","setSession","stringify","close","res","el_option","createElement","text"],"mappings":"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","file":"ico_disclaimer.js","sourcesContent":["var el_residence_list;\nwindow.onload = function() {\n    var frm_select_residence     = document.getElementById('frm_select_residence');\n    var frm_accept_disclaimer    = document.getElementById('frm_accept_disclaimer');\n    var frm_accept_second_notice = document.getElementById('frm_accept_second_notice');\n    el_residence_list            = document.getElementById('residence_list');\n\n    getWebsocketData([\n        { msg_type: 'residence_list', req: { residence_list: 1 } },\n        { msg_type: 'ico_status', req: { ico_status: 1 } },\n    ], function() {\n        var residence_list = JSON.parse(sessionStorage.getItem('residence_list') || null);\n        populateResidenceList(residence_list);\n    });\n\n    function isRestrictedCountry(val) {\n        var ico_status = JSON.parse(sessionStorage.getItem('ico_status') || null);\n        const restricted_countries = ico_status.ico_countries_config.restricted;\n\n        return restricted_countries.indexOf(val) !== -1;\n    }\n\n    var country_names = [\n        { code: 'gb', name: 'the United Kingdom' },\n        { code: 'eu', name: 'the European Economic Area' },\n        { code: 'hk', name: 'Hong Kong' },\n        { code: 'jp', name: 'Japan' },\n    ]\n\n    function showSecondNotice(val) {\n        var country_name;\n        country_names.map(function(item, idx) {\n            if (item.code === val) {\n                country_name = item.name;\n            }\n        });\n        document.getElementById('country_name').appendChild(document.createTextNode(country_name));\n        document.getElementById('notice_msg').classList.remove('invisible');\n        const el = document.getElementById(val);\n        if (el) el.classList.remove('invisible');\n    }\n\n    function showDisclaimer(val) {\n        if (isRestrictedCountry(val)) {\n            // eu countries code\n            if (/^(al|ad|at|by|be|ba|bg|hr|cy|cz|dk|ee|fo|fi|fr|de|gi|gr|hu|is|ie|im|it|ru|lv|li|lt|lu|mk|mt|md|mc|me|nl|no|pl|pt|ro|sm|sk|si|es|se|ch|ua|va)$/.test(val)) {\n                val = 'eu';\n            }\n\n            if (/^(ca|jp|sg|hk|gb|ch|eu)$/.test(val)) {\n                showSecondNotice(val);\n            } else {\n                document.getElementById('access_denied_msg').classList.remove('invisible');\n            }\n        } else {\n            document.getElementById('disclaimer_msg').classList.remove('invisible');\n        }\n    }\n\n    function hideForm() {\n        frm_select_residence.parentNode.classList.add('invisible');\n    }\n\n    frm_accept_disclaimer.addEventListener('submit', function (e) {\n        e.preventDefault();\n        var val = document.getElementById('checkbox').checked; // true or false\n        var url = 'https://ico_documents.binary.com/im.pdf';\n        if (val) {\n            window.location.href = url;\n        } else {\n            document.getElementById('frm_accept_disclaimer_error').classList.remove('invisible');\n        }\n    });\n\n    var validation_set = false; // To prevent validating before submit\n\n    frm_select_residence.addEventListener('submit', function (e) {\n        e.preventDefault();\n        var val = document.getElementById('residence_list').value;\n        if (!validateResidence(this)) {\n            if (!validation_set) {\n                this.addEventListener('change', function (evt) {\n                    evt.preventDefault();\n                    validateResidence(this);\n                    validation_set = true;\n                })\n            }\n            return false;\n        }\n        hideForm();\n        showDisclaimer(val);\n    });\n\n    frm_accept_second_notice.addEventListener('submit', function(e) {\n        e.preventDefault();\n        var val = document.getElementById('checkbox-2').checked; // true or false\n        var url = 'https://ico_documents.binary.com/im.pdf';\n        if (val) {\n            document.getElementById('notice_msg').classList.add('invisible');\n            showDisclaimer(val);\n        } else {\n            document.getElementById('frm_accept_notice_error').classList.remove('invisible');\n        }\n    })\n};\n\nfunction validateResidence(el) {\n    var val      = document.getElementById('residence_list').value;\n    var el_error = el.getElementsByClassName('error-msg')[0];\n    if (val === '0') {\n        el_error.classList.remove('invisible');\n        return false;\n    }\n    el_error.classList.add('invisible');\n    return true;\n}\n\nfunction getWebsocketData(requests, done) {\n    requests = requests.filter(r => !sessionStorage.getItem(r.msg_type));\n\n    if(!requests.length) {\n        setTimeout(done, 0);\n        return;\n    }\n\n    function sendRequests() {\n        requests.forEach(function(r) {\n            wsSend(ws, r.req);\n        })\n    }\n\n    var ws = wsConnect();\n    if (ws.readyState === 1) {\n        sendRequests();\n    } else {\n        ws.onopen = sendRequests;\n    }\n\n    ws.onmessage = function (msg) {\n        var response = JSON.parse(msg.data);\n\n        var msg_type = response.msg_type;\n        setSession(msg_type, JSON.stringify(response[msg_type]));\n        requests = requests.filter(function(r) { return r.msg_type !== msg_type; });\n\n        if (!requests.length) {\n            setTimeout(done, 0);\n            ws.close();\n            return;\n        }\n    }\n}\n\nfunction populateResidenceList(residence_list) {\n    residence_list.forEach(function(res) {\n        var el_option = document.createElement('option');\n        el_option.text  = res.text;\n        el_option.value = res.value;\n        el_residence_list.appendChild(el_option);\n    });\n    document.getElementById('loading').classList.add('invisible');\n    document.getElementById('disclaimer_form').classList.remove('invisible');\n}\n"]}