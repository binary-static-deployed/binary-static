{"version":3,"sources":["../../../src/javascript/landing_pages/japan.js"],"names":["window","onload","initForm","onresize","checkWidth","gclid","getParamValue","document","referrer","localStorage","setItem","commonOnload","signup_forms","querySelectorAll","ws","wsConnect","sendVerifyEmail","val","trimmed_email","trimEmail","wsSend","verify_email","type","verifySubmit","msg","response","JSON","parse","data","setValidationStyle","el_email","error","forEach","el","querySelector","classList","add","remove","str","replace","validation_set","form","addEventListener","handleSubmit","e","preventDefault","el_form","validateEmail","value","evt","to","offsetTop","scrollTo","readyState","onopen","onmessage","email","test","has_error"],"mappings":"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","file":"japan.js","sourcesContent":["/* global toggleMobileMenu:false */\nwindow.onload = function() {\n    initForm();\n\n    window.onresize = checkWidth;\n\n    // Store gclid\n    const gclid = getParamValue(document.referrer, 'gclid');\n    if (gclid) {\n        localStorage.setItem('gclid', gclid);\n    }\n\n    commonOnload();\n};\n\nfunction initForm() {\n    const signup_forms = document.querySelectorAll('.signup-form');\n    let ws = wsConnect();\n\n    function sendVerifyEmail(val) {\n        const trimmed_email = trimEmail(val);\n        wsSend(ws, {\n            verify_email: trimmed_email,\n            type        : 'account_opening',\n        });\n    }\n\n    function verifySubmit(msg) {\n        const response = JSON.parse(msg.data);\n        setValidationStyle(el_email, response.error);\n        if (!response.error) {\n            signup_forms.forEach((el) => {\n                el.querySelector('.signup-form-input').classList.add('invisible');\n                el.querySelector('.signup-form-success').classList.remove('invisible');\n            });\n        }\n    }\n\n    function trimEmail(str) {\n        return str.replace(/\\s/g, '');\n    }\n\n    let validation_set = false; // To prevent validating before submit\n\n    signup_forms.forEach((form) => {\n        form.addEventListener('submit', handleSubmit);\n    });\n\n    let el_email;\n    function handleSubmit(e) {\n        e.preventDefault();\n\n        const el_form  = this;\n        el_email = el_form.querySelector('input[type=\"email\"]');\n        if (!validateEmail(el_email.value)) {\n            if (!validation_set) {\n                ['input', 'change'].forEach((evt) => {\n                    el_email.addEventListener(evt, () => {\n                        setValidationStyle(!validateEmail(el_email.value));\n                    });\n                });\n                setValidationStyle(!validateEmail(el_email.value));\n                validation_set = true;\n            }\n\n            const to = this.offsetTop - 50;\n            scrollTo(to, 500); // Scroll to nearest form\n            return false;\n        }\n\n        if (ws.readyState === 1) {\n            sendVerifyEmail(el_email.value);\n        } else {\n            ws = wsConnect();\n            ws.onopen = sendVerifyEmail(el_email.value);\n            ws.onmessage = verifySubmit;\n        }\n        return true;\n    }\n\n    ws.onmessage = verifySubmit;\n}\n\nfunction validateEmail(email) {\n    return /^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,63}$/.test(email);\n}\n\nfunction setValidationStyle(has_error) {\n    document.querySelectorAll('input[type=\"email\"]').forEach((el) => {\n        el.classList[has_error ? 'add' : 'remove']('error-field');\n    });\n    document.querySelectorAll('.error-msg').forEach((el) => {\n        el.classList[has_error ? 'remove' : 'add']('invisible');\n    });\n}\n"]}